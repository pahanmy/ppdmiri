<!DOCTYPE html>
<html lang="ms" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyKenderaan - MyPPD Miri</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css"/>
    <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/bundle.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .smooth-transition { transition: all 0.3s ease-in-out; }
        .sidebar-link.active { background-color: #eff6ff; color: #2563eb; font-weight: 600; }
        input[type='number']::-webkit-inner-spin-button,
        input[type='number']::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type='number'] { -moz-appearance: textfield; }
        .step-indicator.active .step-circle { background-color: #2563eb; color: white; }
        .step-indicator.active .step-text { color: #2563eb; font-weight: 600; }
        .step-indicator .step-line { background-color: #e5e7eb; }
         .step-indicator.active .step-line { background-color: #2563eb; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="relative min-h-screen md:flex">
        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-60 z-20 md:hidden hidden"></div>

        <aside id="sidebar" class="bg-white text-gray-800 w-64 space-y-6 py-7 px-4 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition duration-300 ease-in-out z-30 shadow-lg">
            <div class="px-2">
                <h1 class="text-2xl font-bold text-blue-700">MyPPD Miri</h1>
            </div>
            
            <nav id="sidebar-nav" class="flex flex-col space-y-2">
                <a href="index.html" data-target="dashboard" class="sidebar-link flex items-center space-x-3 py-2 px-3 rounded-lg text-gray-600 hover:bg-gray-100 smooth-transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>
                    <span class="font-medium">Dashboard</span>
                </a>
                <a href="mytempahan.html" data-target="mytempahan" class="sidebar-link flex items-center space-x-3 py-2 px-3 rounded-lg text-gray-600 hover:bg-gray-100 smooth-transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                    <span class="font-medium">MyTempahan</span>
                </a>
                <a href="mykenderaan.html" data-target="mykenderaan" class="sidebar-link active flex items-center space-x-3 py-2 px-3 rounded-lg text-gray-600 hover:bg-gray-100 smooth-transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10l2-2h8a1 1 0 001-1z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z"></path></svg>
                    <span class="font-medium">MyKenderaan</span>
                </a>
                <a href="myppd.html" data-target="myppd" class="sidebar-link flex items-center space-x-3 py-2 px-3 rounded-lg text-gray-600 hover:bg-gray-100 smooth-transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>
                    <span class="font-medium">MyPPD</span>
                </a>
                <a href="#" data-target="myplanner" class="sidebar-link flex items-center space-x-3 py-2 px-3 rounded-lg text-gray-600 hover:bg-gray-100 smooth-transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>
                    <span class="font-medium">MyPlanner</span>
                </a>
                <a href="#" data-target="myqr" class="sidebar-link flex items-center space-x-3 py-2 px-3 rounded-lg text-gray-600 hover:bg-gray-100 smooth-transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v.01M12 8v.01M12 12v.01M12 16v.01M8 4v.01M8 8v.01M8 12v.01M8 16v.01M4 4v.01M4 8v.01M4 12v.01M4 16v.01M16 4v.01M16 8v.01M16 12v.01M16 16v.01M20 4v.01M20 8v.01M20 12v.01M20 16v.01" />
                    </svg>
                    <span class="font-medium">MyQR</span>
                </a>
            </nav>
        </aside>

        <div class="flex-1 flex flex-col">
            <header class="bg-white shadow-sm md:hidden sticky top-0 z-10">
                <div class="px-6 py-4 flex justify-between items-center">
                    <h1 class="text-xl font-bold text-blue-700">MyPPD Miri</h1>
                    <button id="mobile-menu-button" class="text-gray-600 focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </header>

            <main class="flex-1 p-6 md:p-10">
                <section id="mykenderaan" class="content-section">
                    <div class="bg-white p-6 md:p-8 rounded-xl shadow-md">
                        <div class="flex flex-col md:flex-row items-start md:items-center justify-between pb-6 border-b">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">MyKenderaan</h2>
                                <p class="text-gray-500">Sistem Permohonan Kenderaan Jabatan</p>
                            </div>
                            <div class="mt-4 md:mt-0">
                                <button id="buka-modal-kenderaan" class="w-full sm:w-auto bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 smooth-transition flex items-center justify-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                                    Mohon Kenderaan
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 my-6">
                            <div>
                                <label for="bulan-filter-kenderaan" class="block text-sm font-medium text-gray-600 mb-1">Pilih Bulan</label>
                                <select id="bulan-filter-kenderaan" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></select>
                            </div>
                            <div>
                                <label for="tarikh-filter-kenderaan" class="block text-sm font-medium text-gray-600 mb-1">Pilih Julat Tarikh</label>
                                <input type="text" id="tarikh-filter-kenderaan" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer" readonly>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg text-center">
                                <p class="text-sm font-medium text-blue-800">PERMOHONAN DITEMUI</p>
                                <p id="jumlah-kenderaan" class="text-3xl font-bold text-blue-800">0</p>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white text-sm">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-600">Tarikh Program</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-600">Pemohon</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-600">Lokasi</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-600">Tujuan</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-600">Masa Bertolak</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-600">Status</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-600">Pemandu</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-600">Kenderaan</th>
                                        <th class="text-center py-3 px-4 font-semibold text-gray-600">Dokumen</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-600">Tindakan</th>
                                    </tr>
                                </thead>
                                <tbody id="jadual-kenderaan" class="text-gray-700"></tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </main>

            <footer class="bg-white mt-auto border-t">
                <div class="container mx-auto px-6 py-8 text-center text-gray-500">
                    <p>&copy; 2024 Hak Cipta Terpelihara. Pejabat Pendidikan Daerah Miri.</p>
                </div>
            </footer>
        </div>
    </div>
    
    <div id="modal-batal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
            <div class="p-6 border-b flex justify-between items-center"><h3 class="text-xl font-semibold text-gray-800">Sahkan Pembatalan</h3><button id="tutup-modal-batal" class="text-gray-400 hover:text-gray-600">&times;</button></div>
            <form id="borang-batal"><div class="p-6 space-y-4"><p class="text-sm text-gray-600">Untuk meneruskan pembatalan, sila masukkan semula nombor kad pengenalan anda untuk pengesahan.</p><div id="mesej-batal" class="hidden p-3 rounded-lg text-sm"></div><div><label for="ic-batal" class="block text-sm font-medium text-gray-700 mb-1">No. Kad Pengenalan</label><input type="number" id="ic-batal" placeholder="Masukkan No. KP anda" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500" required></div></div><div class="p-6 bg-gray-50 rounded-b-xl flex justify-end items-center gap-3"><button type="button" id="btn-tutup-batal" class="bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 smooth-transition">Tutup</button><button type="submit" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 smooth-transition">Sahkan Pembatalan</button></div></form>
        </div>
    </div>
    
    <div id="modal-kenderaan" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-screen overflow-y-auto">
             <div class="p-6 border-b flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-800">Borang Permohonan Kenderaan</h3>
                <button id="tutup-modal-kenderaan" class="text-gray-400 hover:text-gray-600">&times;</button>
             </div>
             
            <div class="p-6 border-b">
                <div class="flex items-center">
                    <div id="step-kenderaan-indicator-1" class="step-indicator active flex-1 flex items-center"><div class="step-circle w-8 h-8 rounded-full flex items-center justify-center font-bold">1</div><p class="step-text ml-3 text-sm">Pemohon & Program</p></div>
                    <div class="step-line flex-1 h-0.5"></div>
                    <div id="step-kenderaan-indicator-2" class="step-indicator flex-1 flex items-center"><div class="step-circle w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center font-bold">2</div><p class="step-text ml-3 text-sm text-gray-500">Jadual & Perjalanan</p></div>
                </div>
            </div>

             <form id="borang-kenderaan">
                <div class="p-6">
                    <div id="mesej-kenderaan" class="hidden p-4 mb-4 rounded-lg"></div>
                    
                    <div id="step-kenderaan-1" class="space-y-5">
                        <h4 class="text-lg font-semibold text-gray-700 border-b pb-2">Maklumat Pemohon</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div class="relative"><label for="ic-kenderaan" class="block text-sm font-medium text-gray-700 mb-1">No. KP Pemohon <span class="text-red-500">*</span></label><input type="number" id="ic-kenderaan" placeholder="Sahkan No. KP anda" class="w-full p-3 pl-10 border border-gray-300 rounded-lg" required><div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none top-7"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2a1 1 0 00-1 1v1a1 1 0 002 0V3a1 1 0 00-1-1zM4 4h3a3 3 0 006 0h3a2 2 0 012 2v9a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2zm12 5a1 1 0 100-2H4a1 1 0 100 2h12zM4 13a1 1 0 100-2h6a1 1 0 100 2H4z" clip-rule="evenodd" /></svg></div></div>
                            <div class="relative"><label for="nama-kenderaan" class="block text-sm font-medium text-gray-700 mb-1">Nama Pemohon</label><input type="text" id="nama-kenderaan" class="w-full p-3 pl-10 bg-gray-100 border border-gray-300 rounded-lg" readonly><div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none top-7"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg></div></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div class="relative"><label for="jawatan-kenderaan" class="block text-sm font-medium text-gray-700 mb-1">Jawatan</label><input type="text" id="jawatan-kenderaan" class="w-full p-3 pl-10 bg-gray-100 border border-gray-300 rounded-lg" readonly><div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none top-7"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z" /></svg></div></div>
                            <div class="relative"><label for="telefon-kenderaan" class="block text-sm font-medium text-gray-700 mb-1">No. Telefon <span class="text-red-500">*</span></label><input type="number" id="telefon-kenderaan" placeholder="Cth: 0123456789" class="w-full p-3 pl-10 border border-gray-300 rounded-lg" required><div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none top-7"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" /></svg></div></div>
                        </div>

                        <h4 class="text-lg font-semibold text-gray-700 border-b pb-2 pt-2">Maklumat Program</h4>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tempoh Program <span class="text-red-500">*</span></label>
                            <div class="flex items-center space-x-4">
                                <div class="flex items-center"><input id="satu-hari" name="tempoh_program" type="radio" value="1" class="h-4 w-4 text-blue-600 border-gray-300" checked><label for="satu-hari" class="ml-2 block text-sm text-gray-900">Satu Hari</label></div>
                                <div class="flex items-center"><input id="lebih-sehari" name="tempoh_program" type="radio" value="lebih" class="h-4 w-4 text-blue-600 border-gray-300"><label for="lebih-sehari" class="ml-2 block text-sm text-gray-900">Lebih Sehari</label></div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                             <div class="relative"><label for="tarikh-mula-kenderaan" id="label-tarikh-mula" class="block text-sm font-medium text-gray-700 mb-1">Tarikh <span class="text-red-500">*</span></label><input type="date" id="tarikh-mula-kenderaan" class="w-full p-3 border border-gray-300 rounded-lg" required></div>
                             <div class="relative hidden" id="container-tarikh-tamat-kenderaan"><label for="tarikh-tamat-kenderaan" class="block text-sm font-medium text-gray-700 mb-1">Tarikh Tamat <span class="text-red-500">*</span></label><input type="date" id="tarikh-tamat-kenderaan" class="w-full p-3 border border-gray-300 rounded-lg" required></div>
                        </div>
                         <div><label for="tujuan-kenderaan" class="block text-sm font-medium text-gray-700 mb-1">Tujuan <span class="text-red-500">*</span></label><textarea id="tujuan-kenderaan" rows="3" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="Nyatakan tujuan permohonan dengan jelas" required></textarea></div>
                    </div>

                     <div id="step-kenderaan-2" class="hidden space-y-5">
                        <h4 class="text-lg font-semibold text-gray-700 border-b pb-2">Jadual Perjalanan</h4>
                        
                        <div id="itinerari-container"></div>
                        
                        <h4 class="text-lg font-semibold text-gray-700 border-b pb-2 pt-2">Maklumat Tambahan</h4>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                             <div class="relative"><label for="masa-bertolak-kenderaan" class="block text-sm font-medium text-gray-700 mb-1">Masa Bertolak <span class="text-red-500">*</span></label><input type="time" id="masa-bertolak-kenderaan" class="w-full p-3 border border-gray-300 rounded-lg" required></div>
                             <div>
                                 <label for="bilangan-pegawai-serta" class="block text-sm font-medium text-gray-700 mb-1">Bil. Pegawai Turut Serta</label>
                                 <div class="flex items-center border border-gray-300 rounded-lg">
                                     <button type="button" id="kurang-pegawai" class="px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-l-lg">-</button>
                                     <input type="number" id="bilangan-pegawai-serta" value="0" min="0" class="w-full text-center p-2 border-l border-r focus:outline-none">
                                     <button type="button" id="tambah-pegawai" class="px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-r-lg">+</button>
                                 </div>
                                 <p class="text-xs text-gray-500 mt-1">Tidak termasuk pemohon.</p>
                             </div>
                         </div>
                         <div>
                             <label class="block text-sm font-medium text-gray-700">Aturcara Perjalanan Program (Jika ada)</label>
                             <label for="aturcara-file" class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md cursor-pointer hover:border-blue-500"><div class="space-y-1 text-center"><svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg><div class="flex text-sm text-gray-600"><p class="pl-1">Klik untuk muat naik fail</p><input id="aturcara-file" name="aturcara-file" type="file" class="sr-only"><p id="aturcara-file-name" class="pl-1 text-blue-600 font-semibold"></p></div><p class="text-xs text-gray-500">PDF, DOC, atau DOCX (MAX. 10MB)</p></div></label>
                         </div>
                    </div>
                </div>
                <div class="p-6 bg-gray-50 flex justify-between items-center">
                    <button type="button" id="btn-kembali-kenderaan" class="bg-gray-200 text-gray-700 font-semibold py-2 px-5 rounded-lg hover:bg-gray-300 hidden">Kembali</button>
                    <button type="button" id="btn-seterusnya-kenderaan" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 ml-auto">Seterusnya</button>
                    <button type="submit" id="btn-hantar-kenderaan" class="hidden bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700">Hantar Permohonan</button>
                </div>
             </form>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // === DATA APLIKASI ===
            const pegawaiData = [
                { ic: '850101131234', nama: 'ALI BIN ABU', sektor: 'Sektor Perancangan', jawatan: 'Pegawai Perancangan' },
                { ic: '900202104321', nama: 'SITI BINTI AMINAH', sektor: 'Sektor Pembelajaran', jawatan: 'Penolong Pegawai Pendidikan' },
                { ic: '880303088765', nama: 'HEDRAWATI MOHAMAD', sektor: 'Sektor Pentaksiran dan Peperiksaan', jawatan: 'Ketua Sektor' },
                { ic: '820530134455', nama: 'HASNA BINTI ROSLI', sektor: 'Sektor Pembelajaran', jawatan: 'Guru Cemerlang' }
            ];
            
            let kenderaanData = [
                { id: 101, ic: '820530134455', tarikhMula: '2025-09-30', lokasi: ['SMK Agama', 'SMK Pujut'], pemohon: 'HASNA BINTI ROSLI', masaBertolak: '07:30', tujuan: 'CikguBAT Peringkat Pemikiran Aras Tinggi', status: 'LULUS', catatan: 'Selesai', pemandu: 'EN YUSUF', kenderaan: 'HILUX' },
                { id: 102, ic: '900202104321', tarikhMula: '2025-09-28', lokasi: ['PEI MIN MIDDLE SCHOOL'], pemohon: 'SITI BINTI AMINAH', masaBertolak: '08:00', tujuan: 'PENGHANTARAN MURID DARI SMK MARUDI', status: 'DALAM PROSES', catatan: '-', pemandu: '-', kenderaan: '-' }
            ];
            
            let tempahanUntukBatalId = null;

            // === PENGURUSAN DOM ===
            const sidebar = document.getElementById('sidebar');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            
            // Modal Batal Tempahan
            const modalBatal = document.getElementById('modal-batal');
            const tutupModalBatalBtn = document.getElementById('tutup-modal-batal');
            const btnTutupBatal = document.getElementById('btn-tutup-batal');
            const borangBatal = document.getElementById('borang-batal');
            const inputIcBatal = document.getElementById('ic-batal');
            const mesejBatalEl = document.getElementById('mesej-batal');

            // Modal & Borang Kenderaan
            const modalKenderaan = document.getElementById('modal-kenderaan');
            const bukaModalKenderaanBtn = document.getElementById('buka-modal-kenderaan');
            const tutupModalKenderaanBtn = document.getElementById('tutup-modal-kenderaan');
            const borangKenderaan = document.getElementById('borang-kenderaan');
            const mesejKenderaanEl = document.getElementById('mesej-kenderaan');
            const icKenderaanInput = document.getElementById('ic-kenderaan');
            const namaKenderaanInput = document.getElementById('nama-kenderaan');
            const jawatanKenderaanInput = document.getElementById('jawatan-kenderaan');
            const itinerariContainer = document.getElementById('itinerari-container');
            const tarikhMulaKenderaanInput = document.getElementById('tarikh-mula-kenderaan');
            const tarikhTamatKenderaanInput = document.getElementById('tarikh-tamat-kenderaan');
            const containerTarikhTamatKenderaan = document.getElementById('container-tarikh-tamat-kenderaan');
            const labelTarikhMula = document.getElementById('label-tarikh-mula');
            const tempohProgramRadios = document.querySelectorAll('input[name="tempoh_program"]');
            const aturcaraFileInput = document.getElementById('aturcara-file');
            const aturcaraFileName = document.getElementById('aturcara-file-name');
            const bilanganPegawaiInput = document.getElementById('bilangan-pegawai-serta');
            const kurangPegawaiBtn = document.getElementById('kurang-pegawai');
            const tambahPegawaiBtn = document.getElementById('tambah-pegawai');

            // Wizard Kenderaan
            let currentStepKenderaan = 1;
            const stepsKenderaan = [document.getElementById('step-kenderaan-1'), document.getElementById('step-kenderaan-2')];
            const stepIndicatorsKenderaan = [document.getElementById('step-kenderaan-indicator-1'), document.getElementById('step-kenderaan-indicator-2')];
            const btnKembaliKenderaan = document.getElementById('btn-kembali-kenderaan');
            const btnSeterusnyaKenderaan = document.getElementById('btn-seterusnya-kenderaan');
            const btnHantarKenderaan = document.getElementById('btn-hantar-kenderaan');
            
            // Jadual Kenderaan & Penapis
            const jadualKenderaanBody = document.getElementById('jadual-kenderaan');
            const jumlahKenderaanEl = document.getElementById('jumlah-kenderaan');
            const bulanFilterKenderaan = document.getElementById('bulan-filter-kenderaan');
            const tarikhFilterKenderaan = document.getElementById('tarikh-filter-kenderaan');

            // === FUNGSI-FUNGSI ===
            
            function populateBulanFilter(selectElement) {
                const now = new Date();
                const months = ['Januari', 'Februari', 'Mac', 'April', 'Mei', 'Jun', 'Julai', 'Ogos', 'September', 'Oktober', 'November', 'Disember'];
                selectElement.innerHTML = '<option value="">Pilih Bulan</option>';

                for (let i = -6; i <= 6; i++) {
                    const date = new Date(now.getFullYear(), now.getMonth() + i, 1);
                    const year = date.getFullYear();
                    const month = date.getMonth();
                    const monthName = months[month];
                    const value = `${year}-${String(month + 1).padStart(2, '0')}`;
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = `${monthName} ${year}`;
                    if (i === 0) {
                        option.selected = true;
                    }
                    selectElement.appendChild(option);
                }
            }
            
            // --- FUNGSI UNTUK KENDERAAN ---
            function updateItineraryUI() {
                itinerariContainer.innerHTML = '';
                const isLebihSehari = document.querySelector('input[name="tempoh_program"]:checked').value === 'lebih';

                if (isLebihSehari) {
                    const startDateStr = tarikhMulaKenderaanInput.value;
                    const endDateStr = tarikhTamatKenderaanInput.value;
                    if (startDateStr && endDateStr && new Date(endDateStr) >= new Date(startDateStr)) {
                        generateItineraryTable(startDateStr, endDateStr);
                    } else {
                        itinerariContainer.innerHTML = '<p class="text-sm text-gray-500">Sila pilih julat tarikh yang sah di Langkah 1 untuk menjana jadual itinerari.</p>';
                    }
                } else {
                    itinerariContainer.innerHTML = `
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Itinerari Perjalanan <span class="text-red-500">*</span></label>
                            <div id="lokasi-container" class="space-y-2"></div>
                            <button type="button" id="tambah-lokasi-btn" class="mt-2 text-sm text-blue-600 hover:text-blue-800 font-semibold flex items-center gap-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" /></svg>
                                Tambah Destinasi
                            </button>
                        </div>`;
                    tambahInputLokasi(true); 
                }
            }

            function tambahInputLokasi(isFirst = false) {
                const container = document.getElementById('lokasi-container');
                if (!container) return;
                const count = container.children.length;
                const div = document.createElement('div');
                div.className = 'flex items-center gap-2';
                const required = 'required';
                const label = isFirst ? 'Dari (Mula)' : `Destinasi ${count}`;

                div.innerHTML = `
                    <div class="relative flex-grow">
                         <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500 text-sm w-36 truncate">${label}:</span>
                        <input type="text" name="lokasi" class="w-full p-3 pl-40 border border-gray-300 rounded-lg" ${required}>
                    </div>
                    ${!isFirst ? `<button type="button" class="padam-lokasi-btn p-2 text-red-500 hover:bg-red-100 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>
                    </button>` : '<div class="w-9 h-9"></div>'}
                `;
                container.appendChild(div);
                if (!isFirst) {
                    div.querySelector('input').focus();
                }
            }
            
            function updateNomborLokasi() {
                const items = document.querySelectorAll('#lokasi-container .relative.flex-grow');
                items.forEach((item, index) => {
                    const label = item.querySelector('span');
                    label.textContent = index === 0 ? 'Dari (Mula):' : `Destinasi ${index}:`;
                });
            }


            function generateItineraryTable(startDateStr, endDateStr) {
                const startDate = new Date(startDateStr);
                const endDate = new Date(endDateStr);
                let tableHtml = `<div class="border rounded-lg overflow-hidden"><table class="min-w-full"><thead class="bg-gray-100"><tr><th class="p-2 text-left text-sm font-semibold text-gray-600">Tarikh</th><th class="p-2 text-left text-sm font-semibold text-gray-600">Aktiviti / Lokasi <span class="text-red-500">*</span></th></tr></thead><tbody>`;

                for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                    const dateString = d.toLocaleDateString('ms-MY', { weekday: 'long', day: 'numeric', month: 'long' });
                    const dateValue = d.toISOString().split('T')[0];
                    tableHtml += `<tr class="border-t"><td class="p-2 align-top text-sm font-medium text-gray-700">${dateString}</td><td class="p-2"><textarea name="itinerari_harian" data-date="${dateValue}" class="w-full p-2 border border-gray-300 rounded-lg text-sm" rows="2" placeholder="Nyatakan aktiviti/lokasi untuk hari ini" required></textarea></td></tr>`;
                }
                tableHtml += `</tbody></table></div>`;
                itinerariContainer.innerHTML = tableHtml;
            }


            function applyFiltersAndRenderKenderaan() {
                const startDate = pickerKenderaan.getStartDate() ? pickerKenderaan.getStartDate().dateInstance : null;
                const endDate = pickerKenderaan.getEndDate() ? pickerKenderaan.getEndDate().dateInstance : null;

                if(startDate) startDate.setHours(0, 0, 0, 0);
                if(endDate) endDate.setHours(23, 59, 59, 999);

                const filteredData = kenderaanData.filter(item => {
                    const itemDate = new Date(item.tarikhMula);
                    itemDate.setHours(12, 0, 0, 0);
                    return (!startDate || !endDate) || (itemDate >= startDate && itemDate <= endDate);
                });
                
                paparJadualKenderaan(filteredData);
            }
            
            function paparJadualKenderaan(data) {
                jadualKenderaanBody.innerHTML = '';
                data.sort((a, b) => new Date(b.tarikhMula) - new Date(a.tarikhMula));
                 if (data.length === 0) {
                    jadualKenderaanBody.innerHTML = `<tr><td colspan="10" class="text-center py-10 text-gray-500">Tiada permohonan ditemui untuk kriteria ini.</td></tr>`;
                } else {
                    data.forEach(item => {
                        let statusClass, rowClass = '';
                        if (item.status === 'LULUS') { statusClass = 'bg-green-100 text-green-700'; } 
                        else if (item.status === 'DIBATALKAN') { statusClass = 'bg-gray-200 text-gray-600'; rowClass = 'text-gray-400 italic'; }
                        else if (item.status === 'DALAM PROSES') { statusClass = 'bg-yellow-100 text-yellow-800';}
                        
                        const formatTarikh = new Date(item.tarikhMula).toLocaleDateString('ms-MY', { day: 'numeric', month: 'short', year: 'numeric' });
                        const lokasiHtml = Array.isArray(item.lokasi) && item.lokasi.length > 0
                            ? `<ol class="list-decimal list-inside">${item.lokasi.map(l => `<li>${l}</li>`).join('')}</ol>` 
                            : 'Tiada';
                        
                        const butangBatal = item.status !== 'DIBATALKAN'
                            ? `<button class="batal-btn text-red-600 hover:text-red-800 p-1 rounded-md hover:bg-red-50 flex items-center gap-1" data-id="${item.id}" data-type="kenderaan">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                                <span class="text-xs font-medium">Batal</span>
                              </button>` : '-';

                        const row = `<tr class="border-b hover:bg-gray-50 ${rowClass}">
                            <td class="p-2">${formatTarikh}</td>
                            <td class="p-2">${item.pemohon}</td>
                            <td class="p-2">${lokasiHtml}</td>
                            <td class="p-2">${item.tujuan}</td>
                            <td class="p-2">${item.masaBertolak}</td>
                            <td class="p-2"><span class="${statusClass} text-xs font-semibold px-2.5 py-1 rounded-full">${item.status}</span></td>
                            <td class="p-2">${item.pemandu}</td>
                            <td class="p-2">${item.kenderaan}</td>
                            <td class="p-2 text-center">
                                <div class="flex justify-center gap-2">
                                    <button class="text-green-600 hover:text-green-800 p-1.5 rounded-md hover:bg-green-50"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg></button>
                                    <button class="text-red-600 hover:text-red-800 p-1.5 rounded-md hover:bg-red-50"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></button>
                                </div>
                            </td>
                            <td class="p-2">${butangBatal}</td>
                        </tr>`;
                        jadualKenderaanBody.innerHTML += row;
                    });
                }
                 jumlahKenderaanEl.textContent = data.length;
            }
            
            // --- FUNGSI UMUM ---
            function openSidebar() { sidebar.classList.remove('-translate-x-full'); sidebarOverlay.classList.remove('hidden'); }
            function closeSidebar() { sidebar.classList.add('-translate-x-full'); sidebarOverlay.classList.add('hidden'); }
            
             function resetBorangKenderaan() {
                borangKenderaan.reset();
                namaKenderaanInput.value = '';
                jawatanKenderaanInput.value = '';
                aturcaraFileName.textContent = '';
                mesejKenderaanEl.classList.add('hidden');
                goToStepKenderaan(1);
                document.getElementById('satu-hari').checked = true;
                tempohProgramRadios[0].dispatchEvent(new Event('change'));
                setTodayDate();
             }

            function openModal(modal) { 
                if (modal.id === 'modal-kenderaan') { resetBorangKenderaan(); }
                modal.classList.remove('hidden'); 
            }
            function closeModal(modal) { modal.classList.add('hidden'); }

            function openModalBatal(id, type) {
                tempahanUntukBatalId = { id, type };
                borangBatal.reset();
                mesejBatalEl.classList.add('hidden');
                modalBatal.classList.remove('hidden');
            }
            function closeModalBatal() { modalBatal.classList.add('hidden'); }

            function paparkanMesej(el, jenis, teks) {
                el.textContent = teks;
                el.className = `p-3 rounded-lg text-sm ${jenis === 'ralat' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;
                el.classList.remove('hidden');
            }
            
            function setTodayDate() {
                const today = new Date().toISOString().split('T')[0];
                tarikhMulaKenderaanInput.value = today; tarikhMulaKenderaanInput.min = today;
                tarikhTamatKenderaanInput.value = today; tarikhTamatKenderaanInput.min = today;
            }

            function goToStepKenderaan(stepNumber) {
                currentStepKenderaan = stepNumber;
                stepsKenderaan.forEach((step, index) => step.classList.toggle('hidden', index + 1 !== currentStepKenderaan));
                stepIndicatorsKenderaan.forEach((indicator, index) => indicator.classList.toggle('active', index < currentStepKenderaan));
                btnKembaliKenderaan.classList.toggle('hidden', currentStepKenderaan === 1);
                btnSeterusnyaKenderaan.classList.toggle('hidden', currentStepKenderaan === 2);
                btnHantarKenderaan.classList.toggle('hidden', currentStepKenderaan !== 2);
                if (stepNumber === 2) {
                    updateItineraryUI();
                }
            }

            function validateStep(stepNumber, formType) {
                const isKenderaan = formType === 'kenderaan';
                const stepElement = isKenderaan ? stepsKenderaan[stepNumber - 1] : null;
                const mesejElement = isKenderaan ? mesejKenderaanEl : null;
                if (!stepElement) return false;

                const inputs = stepElement.querySelectorAll('[required]');
                for (const input of inputs) {
                     if (!input.closest('.hidden') && !input.value.trim()) { 
                        let labelText = '';
                        const label = input.closest('div').querySelector('label');
                        if (label) {
                            labelText = label.textContent.replace('*', '').trim();
                        } else {
                            labelText = "Jadual Itinerari";
                        }
                        paparkanMesej(mesejElement, 'ralat', `Sila isi medan "${labelText}".`);
                        input.focus();
                        return false;
                    }
                }
                
                if (isKenderaan) {
                     if (stepNumber === 1 && !namaKenderaanInput.value) {
                        paparkanMesej(mesejKenderaanEl, 'ralat', 'No Kad Pengenalan tidak ditemui. Sila pastikan ia betul.');
                        icKenderaanInput.focus();
                        return false;
                    }
                }
                
                mesejElement.classList.add('hidden');
                return true;
            }

            // === EVENT LISTENERS ===
            mobileMenuButton.addEventListener('click', (e) => { e.stopPropagation(); openSidebar(); });
            sidebarOverlay.addEventListener('click', closeSidebar);
            
            // Listeners Kenderaan
            bukaModalKenderaanBtn.addEventListener('click', () => openModal(modalKenderaan));
            tutupModalKenderaanBtn.addEventListener('click', () => closeModal(modalKenderaan));
            modalKenderaan.addEventListener('click', (e) => { 
                if(e.target === modalKenderaan) closeModal(modalKenderaan);
                const padamBtn = e.target.closest('.padam-lokasi-btn');
                if (padamBtn) {
                    const container = document.getElementById('lokasi-container');
                    if(container.children.length > 1) {
                        padamBtn.closest('.flex.items-center.gap-2').remove();
                        updateNomborLokasi();
                    }
                }
                if (e.target.id === 'tambah-lokasi-btn') {
                    tambahInputLokasi(false);
                    updateNomborLokasi();
                }
            });

            icKenderaanInput.addEventListener('blur', () => {
                const pegawai = pegawaiData.find(p => p.ic === icKenderaanInput.value);
                namaKenderaanInput.value = pegawai ? pegawai.nama : '';
                jawatanKenderaanInput.value = pegawai ? pegawai.jawatan : '';
            });
            
            tempohProgramRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const isLebihSehari = e.target.value === 'lebih';
                    containerTarikhTamatKenderaan.classList.toggle('hidden', !isLebihSehari);
                    labelTarikhMula.innerHTML = isLebihSehari ? 'Tarikh Mula <span class="text-red-500">*</span>' : 'Tarikh <span class="text-red-500">*</span>';
                });
            });

            [tarikhMulaKenderaanInput, tarikhTamatKenderaanInput].forEach(input => {
                input.addEventListener('change', () => {
                    if (currentStepKenderaan === 2) updateItineraryUI();
                });
            });


            aturcaraFileInput.addEventListener('change', () => {
                if (aturcaraFileInput.files.length > 0) {
                    aturcaraFileName.textContent = aturcaraFileInput.files[0].name;
                }
            });
            kurangPegawaiBtn.addEventListener('click', () => { let val = parseInt(bilanganPegawaiInput.value); if (val > 0) bilanganPegawaiInput.value = val - 1; });
            tambahPegawaiBtn.addEventListener('click', () => { bilanganPegawaiInput.value = parseInt(bilanganPegawaiInput.value) + 1; });


            // Listeners Batal (Umum)
            tutupModalBatalBtn.addEventListener('click', closeModalBatal);
            btnTutupBatal.addEventListener('click', closeModalBatal);
            modalBatal.addEventListener('click', (e) => { if (e.target === modalBatal) closeModalBatal(); });
            
            // Wizard Navigation
            btnSeterusnyaKenderaan.addEventListener('click', () => { if (validateStep(currentStepKenderaan, 'kenderaan')) { goToStepKenderaan(currentStepKenderaan + 1); }});
            btnKembaliKenderaan.addEventListener('click', () => { goToStepKenderaan(currentStepKenderaan - 1); });
            
            jadualKenderaanBody.addEventListener('click', (e) => {
                const btn = e.target.closest('.batal-btn');
                if (btn) {
                    const id = parseInt(btn.dataset.id, 10);
                    const type = btn.dataset.type;
                    if (type === 'kenderaan') {
                        openModalBatal(id, type);
                    }
                }
            });

            borangBatal.addEventListener('submit', (e) => {
                e.preventDefault();
                const { id, type } = tempahanUntukBatalId;
                if (type !== 'kenderaan') return;
                
                const dataArray = kenderaanData;
                const item = dataArray.find(t => t.id === id);
                if (!item) return;

                if (inputIcBatal.value === item.ic) {
                    item.status = 'DIBATALKAN';
                    applyFiltersAndRenderKenderaan();
                    closeModalBatal();
                } else {
                    paparkanMesej(mesejBatalEl, 'ralat', 'No. Kad Pengenalan tidak sepadan. Pembatalan gagal.');
                }
            });

            borangKenderaan.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!validateStep(2, 'kenderaan')) return;
                
                const ic = icKenderaanInput.value;
                const pemohon = pegawaiData.find(p => p.ic === ic);
                if (!pemohon) { paparkanMesej(mesejKenderaanEl, 'ralat', 'No. KP tidak ditemui.'); return; }
                
                const isLebihSehari = document.querySelector('input[name="tempoh_program"]:checked').value === 'lebih';
                let lokasiArray;

                if(isLebihSehari) {
                    const itinerariInputs = document.querySelectorAll('#itinerari-container textarea[name="itinerari_harian"]');
                    lokasiArray = Array.from(itinerariInputs).map(input => `${input.closest('tr').querySelector('td').textContent}: ${input.value.trim()}`);
                } else {
                    const lokasiInputs = document.querySelectorAll('#lokasi-container input[name="lokasi"]');
                    lokasiArray = Array.from(lokasiInputs).map(input => input.value.trim()).filter(val => val !== '');
                }

                if(lokasiArray.length === 0 || lokasiArray.some(l => l.endsWith(': ')) || lokasiArray.some(l => l === '')){
                    paparkanMesej(mesejKenderaanEl, 'ralat', 'Sila lengkapkan semua medan itinerari/lokasi.');
                    return;
                }

                const permohonanBaru = {
                    id: Date.now(),
                    ic: ic,
                    tarikhMula: document.getElementById('tarikh-mula-kenderaan').value,
                    lokasi: lokasiArray,
                    pemohon: pemohon.nama,
                    masaBertolak: document.getElementById('masa-bertolak-kenderaan').value,
                    tujuan: document.getElementById('tujuan-kenderaan').value,
                    status: 'DALAM PROSES',
                    catatan: '-', pemandu: '-', kenderaan: '-'
                };

                kenderaanData.push(permohonanBaru);
                applyFiltersAndRenderKenderaan();
                paparkanMesej(mesejKenderaanEl, 'berjaya', 'Permohonan kenderaan telah berjaya dihantar.');
                setTimeout(() => closeModal(modalKenderaan), 2000);
            });
            
            // === INISIALISASI ===
            const pickerKenderaan = new Litepicker({
                element: tarikhFilterKenderaan, singleMode: false, format: 'DD MMM YYYY', lang: 'ms-MY',
                setup: (picker) => { picker.on('selected', (d1, d2) => { bulanFilterKenderaan.value = ''; applyFiltersAndRenderKenderaan(); }); }
            });

             bulanFilterKenderaan.addEventListener('change', () => {
                const selectedMonth = bulanFilterKenderaan.value;
                if (selectedMonth) { const [year, month] = selectedMonth.split('-').map(Number); const startDate = new Date(year, month - 1, 1); const endDate = new Date(year, month, 0); pickerKenderaan.setDateRange(startDate, endDate); }
            });
            
            populateBulanFilter(bulanFilterKenderaan);
            
            const today = new Date();
            const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            pickerKenderaan.setDateRange(startOfMonth, endOfMonth);

            setTodayDate();
        });
    </script>
</body>
</html>
